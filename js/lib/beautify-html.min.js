/*

  The MIT License (MIT)

  Copyright (c) 2007-2013 Einar Lielmanis and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.


 Style HTML
---------------

  Written by Nochum Sossonko, (nsossonko@hotmail.com)

  Based on code initially developed by: Einar Lielmanis, <elfz@laacz.lv>
    http://jsbeautifier.org/

  Usage:
    style_html(html_source);

    style_html(html_source, options);

  The options are:
    indent_inner_html (default false)  — indent <head> and <body> sections,
    indent_size (default 4)          — indentation size,
    indent_char (default space)      — character to indent with,
    wrap_line_length (default 250)            -  maximum amount of characters per line (0 = disable)
    brace_style (default "collapse") - "collapse" | "expand" | "end-expand"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.
    unformatted (defaults to inline tags) - list of tags, that shouldn't be reformatted
    indent_scripts (default normal)  - "keep"|"separate"|"normal"
    preserve_newlines (default true) - whether existing line breaks before elements should be preserved
                                        Only works before elements, not inside tags or for text.
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk
    indent_handlebars (default false) - format and indent {{#foo}} and {{/foo}}

    e.g.

    style_html(html_source, {
      'indent_inner_html': false,
      'indent_size': 2,
      'indent_char': ' ',
      'wrap_line_length': 78,
      'brace_style': 'expand',
      'unformatted': ['a', 'sub', 'sup', 'b', 'i', 'u'],
      'preserve_newlines': true,
      'max_preserve_newlines': 5,
      'indent_handlebars': false
    });
*/
(function(){function k(d,e,k,l){var a,r,g,h,m,s,p,t,u;e=e||{};void 0!==e.wrap_line_length&&0!==parseInt(e.wrap_line_length,10)||void 0!==e.max_char&&0!==parseInt(e.max_char,10)||(e.wrap_line_length=e.max_char);r=e.indent_inner_html||!1;g=parseInt(e.indent_size||4,10);h=e.indent_char||" ";s=e.brace_style||"collapse";m=0===parseInt(e.wrap_line_length,10)?32786:parseInt(e.wrap_line_length||250,10);p=e.unformatted||"a span bdo em strong dfn code samp kbd var cite abbr acronym q sub sup tt i b big small u s strike font ins del pre address dt h1 h2 h3 h4 h5 h6".split(" ");
u=(t=e.preserve_newlines||!0,parseInt(e.max_preserve_newlines||32786,10));indent_handlebars=e.indent_handlebars||!1;a=new function(){this.pos=0;this.token="";this.current_mode="CONTENT";this.tags={parent:"parent1",parentcount:1,parent1:""};this.token_text=this.last_token=this.last_text=this.token_type=this.tag_type="";this.newlines=0;this.indent_content=r;this.Utils={whitespace:["\n","\r","\t"," "],single_token:"br input link meta !doctype basefont base area hr wbr param img isindex ?xml embed ?php ? ?=".split(" "),
extra_liners:["head","body","/html"],in_array:function(c,b){for(var a=0;a<b.length;a++)if(c===b[a])return!0;return!1}};this.traverse_whitespace=function(){var c="",c=this.input.charAt(this.pos);if(this.Utils.in_array(c,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(c,this.Utils.whitespace);)t&&"\n"===c&&this.newlines<=u&&(this.newlines+=1),this.pos++,c=this.input.charAt(this.pos);return!0}return!1};this.get_content=function(){for(var c="",b=[],a=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=
this.input.length)return b.length?b.join(""):["","TK_EOF"];if(this.traverse_whitespace())b.length&&(a=!0);else{if(indent_handlebars)if(c=this.input.substr(this.pos,3),"{{#"===c||"{{/"===c)break;else if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break;c=this.input.charAt(this.pos);this.pos++;a&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,b),this.print_indentation(b)):(this.line_char_count++,b.push(" ")),a=!1);this.line_char_count++;b.push(c)}}return b.length?
b.join(""):""};this.get_contents_to=function(c){if(this.pos===this.input.length)return["","TK_EOF"];var b="";c=RegExp("</"+c+"\\s*>","igm");c.lastIndex=this.pos;c=(c=c.exec(this.input))?c.index:this.input.length;this.pos<c&&(b=this.input.substring(this.pos,c),this.pos=c);return b};this.record_tag=function(c){this.tags[c+"count"]?this.tags[c+"count"]++:this.tags[c+"count"]=1;this.tags[c+this.tags[c+"count"]]=this.indent_level;this.tags[c+this.tags[c+"count"]+"parent"]=this.tags.parent;this.tags.parent=
c+this.tags[c+"count"]};this.retrieve_tag=function(c){if(this.tags[c+"count"]){for(var b=this.tags.parent;b&&c+this.tags[c+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[c+this.tags[c+"count"]],this.tags.parent=this.tags[b+"parent"]);delete this.tags[c+this.tags[c+"count"]+"parent"];delete this.tags[c+this.tags[c+"count"]];1===this.tags[c+"count"]?delete this.tags[c+"count"]:this.tags[c+"count"]--}};this.indent_to_tag=function(c){if(this.tags[c+"count"]){for(var b=this.tags.parent;b&&
c+this.tags[c+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[c+this.tags[c+"count"]])}};this.get_tag=function(c){var b="",a=[],b="",e=!1,d,f,v=this.pos,g=this.line_char_count;c=void 0!==c?c:!1;do{if(this.pos>=this.input.length)return c&&(this.pos=v,this.line_char_count=g),a.length?a.join(""):["","TK_EOF"];b=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(b,this.Utils.whitespace))e=!0;else{if("'"===b||'"'===b)b+=this.get_unformatted(b),e=!0;"="===b&&(e=!1);a.length&&
"="!==a[a.length-1]&&">"!==b&&e&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,a),this.print_indentation(a)):(a.push(" "),this.line_char_count++),e=!1);indent_handlebars&&"<"===f&&"{{"===b+this.input.charAt(this.pos)&&(b+=this.get_unformatted("}}"),a.length&&" "!==a[a.length-1]&&"<"!==a[a.length-1]&&(b=" "+b),e=!0);"<"!==b||f||(d=this.pos-1,f="<");indent_handlebars&&!f&&2<=a.length&&"{"===a[a.length-1]&&"{"==a[a.length-2]&&(d="#"===b||"/"===b?this.pos-3:this.pos-2,f="{");this.line_char_count++;
a.push(b);if(a[1]&&"!"===a[1]){a=[this.get_comment(d)];break}if(indent_handlebars&&"{"===f&&2<a.length&&"}"===a[a.length-2]&&"}"===a[a.length-1])break}}while(">"!==b);f=a.join("");b=-1!==f.indexOf(" ")?f.indexOf(" "):"{"===f[0]?f.indexOf("}"):f.indexOf(">");b=f.substring("<"!==f[0]&&indent_handlebars?"#"===f[2]?3:2:1,b).toLowerCase();"/"===f.charAt(f.length-2)||this.Utils.in_array(b,this.Utils.single_token)?c||(this.tag_type="SINGLE"):indent_handlebars&&"{"===f[0]&&"else"===b?c||(this.indent_to_tag("if"),
this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):"script"===b?c||(this.record_tag(b),this.tag_type="SCRIPT"):"style"===b?c||(this.record_tag(b),this.tag_type="STYLE"):this.is_unformatted(b,p)?(b=this.get_unformatted("</"+b+">",f),a.push(b),0<d&&this.Utils.in_array(this.input.charAt(d-1),this.Utils.whitespace)&&a.splice(0,0,this.input.charAt(d-1)),d=this.pos-1,this.Utils.in_array(this.input.charAt(d+1),this.Utils.whitespace)&&a.push(this.input.charAt(d+1)),this.tag_type=
"SINGLE"):"!"===b.charAt(0)?c||(this.tag_type="SINGLE",this.traverse_whitespace()):c||("/"===b.charAt(0)?(this.retrieve_tag(b.substring(1)),this.tag_type="END"):(this.record_tag(b),"html"!==b.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace(),this.Utils.in_array(b,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output)));c&&(this.pos=v,this.line_char_count=
g);return a.join("")};this.get_comment=function(a){var b="",e=">",d=!1;this.pos=a;input_char=this.input.charAt(this.pos);for(this.pos++;this.pos<=this.input.length;){b+=input_char;if(b[b.length-1]===e[e.length-1]&&-1!==b.indexOf(e))break;!d&&10>b.length&&(0===b.indexOf("<![if")?(e="<![endif]>",d=!0):0===b.indexOf("<![cdata[")?(e="]]\x3e",d=!0):0===b.indexOf("<![")?(e="]>",d=!0):0===b.indexOf("\x3c!--")&&(e="--\x3e",d=!0));input_char=this.input.charAt(this.pos);this.pos++}return b};this.get_unformatted=
function(a,b){if(b&&-1!==b.toLowerCase().indexOf(a))return"";var e="",d="",g=0,f=!0;do{if(this.pos>=this.input.length)break;e=this.input.charAt(this.pos);this.pos++;if(this.Utils.in_array(e,this.Utils.whitespace)){if(!f){this.line_char_count--;continue}if("\n"===e||"\r"===e){d+="\n";this.line_char_count=0;continue}}d+=e;this.line_char_count++;f=!0;indent_handlebars&&"{"===e&&d.length&&"{"===d[d.length-2]&&(d+=this.get_unformatted("}}"),g=d.length)}while(-1===d.toLowerCase().indexOf(a,g));return d};
this.get_token=function(){var a;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var b=this.last_token.substr(7);a=this.get_contents_to(b);return"string"!==typeof a?a:[a,"TK_"+b]}if("CONTENT"===this.current_mode)return a=this.get_content(),"string"!==typeof a?a:[a,"TK_CONTENT"];if("TAG"===this.current_mode)return a=this.get_tag(),"string"!==typeof a?a:[a,"TK_TAG_"+this.tag_type]};this.get_full_indent=function(a){a=this.indent_level+a||0;return 1>a?"":Array(a+1).join(this.indent_string)};
this.is_unformatted=function(a,b){if(!this.Utils.in_array(a,b))return!1;if("a"!==a.toLowerCase()||!this.Utils.in_array("a",b))return!0;var d=(this.get_tag(!0)||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!d||this.Utils.in_array(d,b)?!0:!1};this.printer=function(a,b,d,e,g){this.input=a||"";this.output=[];this.indent_character=b;this.indent_string="";this.indent_size=d;this.brace_style=g;this.indent_level=0;this.wrap_line_length=e;for(a=this.line_char_count=0;a<this.indent_size;a++)this.indent_string+=
this.indent_character;this.print_newline=function(a,b){this.line_char_count=0;b&&b.length&&(a||"\n"!==b[b.length-1])&&b.push("\n")};this.print_indentation=function(a){for(var b=0;b<this.indent_level;b++)a.push(this.indent_string),this.line_char_count+=this.indent_string.length};this.print_token=function(a){(a||""!==a)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),a=a.replace(/^\s+/g,""));this.print_token_raw(a)};this.print_token_raw=function(a){a&&
""!==a&&(1<a.length&&"\n"===a[a.length-1]?(this.output.push(a.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(a));for(a=0;a<this.newlines;a++)this.print_newline(0<a,this.output);this.newlines=0};this.indent=function(){this.indent_level++};this.unindent=function(){0<this.indent_level&&this.indent_level--}};return this};for(a.printer(d,h,g,m,s);;){d=a.get_token();a.token_text=d[0];a.token_type=d[1];if("TK_EOF"===a.token_type)break;switch(a.token_type){case "TK_TAG_START":a.print_newline(!1,
a.output);a.print_token(a.token_text);a.indent_content&&(a.indent(),a.indent_content=!1);a.current_mode="CONTENT";break;case "TK_TAG_STYLE":case "TK_TAG_SCRIPT":a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_END":"TK_CONTENT"===a.last_token&&""===a.last_text&&(d=a.token_text.match(/\w+/)[0],g=null,a.output.length&&(g=a.output[a.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),null!==g&&g[1]===d||a.print_newline(!1,a.output));a.print_token(a.token_text);
a.current_mode="CONTENT";break;case "TK_TAG_SINGLE":(d=a.token_text.match(/^\s*<([a-z]+)/i))&&a.Utils.in_array(d[1],p)||a.print_newline(!1,a.output);a.print_token(a.token_text);a.current_mode="CONTENT";break;case "TK_TAG_HANDLEBARS_ELSE":a.print_token(a.token_text);a.indent_content&&(a.indent(),a.indent_content=!1);a.current_mode="CONTENT";break;case "TK_CONTENT":a.print_token(a.token_text);a.current_mode="TAG";break;case "TK_STYLE":case "TK_SCRIPT":if(""!==a.token_text){a.print_newline(!1,a.output);
d=a.token_text;var n;h=1;"TK_SCRIPT"===a.token_type?n="function"===typeof k&&k:"TK_STYLE"===a.token_type&&(n="function"===typeof l&&l);"keep"===e.indent_scripts?h=0:"separate"===e.indent_scripts&&(h=-a.indent_level);g=a.get_full_indent(h);n?d=n(d.replace(/^\s*/,g),e):(m=d.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(a.indent_string).length-1,h=a.get_full_indent(h-m),d=d.replace(/^\s*/,g).replace(/\r\n|\r|\n/g,"\n"+h).replace(/\s+$/,""));d&&(a.print_token_raw(g+d.replace(/^\s+|\s+$/g,"")),a.print_newline(!1,
a.output))}a.current_mode="TAG"}a.last_token=a.token_type;a.last_text=a.token_text}return a.output.join("")}if("function"===typeof define)define(["./beautify.js","./beautify-css.js"],function(d,e){return{html_beautify:function(q,l){return k(q,l,d,e)}}});else if("undefined"!==typeof exports){var q=require("./beautify.js").js_beautify,w=require("./beautify-css.js").css_beautify;exports.html_beautify=function(d,e){return k(d,e,q,w)}}else"undefined"!==typeof window?window.html_beautify=function(d,e){return k(d,
e,window.js_beautify,window.css_beautify)}:"undefined"!==typeof global&&(global.html_beautify=function(d,e){return k(d,e,global.js_beautify,global.css_beautify)})})();
